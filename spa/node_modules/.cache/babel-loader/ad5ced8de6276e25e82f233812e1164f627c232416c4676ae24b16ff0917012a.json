{"ast":null,"code":"import{useContext,useEffect,useState}from\"react\";import bgImage from\"../../assets/img/backgroundImage.png\";import emailImage from\"../../assets/img/emailVerification.png\";import{useLocation,useNavigate}from\"react-router-dom\";import{AuthContext}from\"../../context/AuthContext\";import{Button}from\"@material-tailwind/react\";import{FontAwesomeIcon}from\"@fortawesome/react-fontawesome\";import{faEnvelope}from\"@fortawesome/free-solid-svg-icons\";import{useParams}from\"react-router-dom\";import{ME,resendVerificationEmail,verifyEmail}from\"../../service/api_service\";import toast from\"react-hot-toast\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const EmailVerification=()=>{const[zoom,setZoom]=useState(\"scale-0\");const[userEmail,setUserEmail]=useState(\"\");const navigate=useNavigate();const{checkLogin}=useContext(AuthContext);const location=useLocation();const[isButtonDisabled,setIsButtonDisabled]=useState(false);const[countdown,setCountdown]=useState(0);useEffect(()=>{async function emailVerification(token){try{const response=await verifyEmail(token);if(response===\"User already verified\"){toast.error(\"User already verified\");localStorage.clear();navigate(\"/login\");}if(response===\"jwt expired\"){toast.error(\"Verified link Expired!\");navigate(\"/login\");return;}if(response.isVerified){localStorage.removeItem(\"verifyEmail\");toast.success(\"Email Verified Successfully!\");navigate(\"/login\");}}catch(error){console.log(\"error in verifyEmail use effects\",error);if(error===\"User already verified\"){toast.error(\"User already verified\");localStorage.clear();navigate(\"/login\");return;}toast.error((error===null||error===void 0?void 0:error.message)||error);}}const params=new URLSearchParams(location.search);const token=params.get(\"token\");if(token){emailVerification(token);}},[]);useEffect(()=>{const email=localStorage.getItem(\"userEmail\");setUserEmail(email);checkLogin(\"/login\");setTimeout(()=>{setZoom(\"scale-100\");},500);// Adjust the delay as needed\n},[]);const resetFields=async()=>{localStorage.clear();navigate(\"/sign-up\");};const resendEmail=async()=>{const userEmail=localStorage.getItem(\"userEmail\");await resendVerificationEmail(userEmail);toast.success(\"Verification Email Sent!\");setIsButtonDisabled(true);localStorage.setItem(\"buttonClickTimestamp\",Date.now().toString());const twoMinutesInMillis=2*60*1000;setCountdown(120);const timer=setInterval(()=>{setCountdown(prevCountdown=>prevCountdown-1);},1000);setTimeout(()=>{clearInterval(timer);setIsButtonDisabled(false);localStorage.removeItem(\"buttonClickTimestamp\");setCountdown(0);},twoMinutesInMillis);};return/*#__PURE__*/_jsx(\"div\",{className:\"bg-cover bg-center h-screen\",style:{backgroundImage:\"url(\".concat(bgImage,\")\")},children:/*#__PURE__*/_jsx(\"div\",{className:\"flex min-h-full flex-col justify-center h-full px-4 py-8 lg:px-8\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"\".concat(zoom,\" transition-transform duration-500 ease-in-out sm:mx-auto sm:w-full sm:max-w-sm p-6 bg-grey-100 border border-gray-100 rounded-lg shadow dark:bg-gray-100 dark:border-gray-200\"),children:[/*#__PURE__*/_jsx(\"div\",{className:\"sm:mx-auto sm:w-full sm:max-w-sm\"}),/*#__PURE__*/_jsxs(\"div\",{className:\" sm:mx-auto sm:w-full sm:max-w-md\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"\",children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"img\",{className:\" h-full w-auto\",src:emailImage,alt:\"Your Company\"})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"h2\",{className:\"text-center text-2xl font-semibold leading-9 tracking-tight text-gray-900\",children:\"Verify your account\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-center flex flex-col mt-4\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Thanks for signup with us.\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Click on the button below to verify your email address.\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\" sm:mx-auto sm:w-full sm:max flex justify-center mt-4\",children:/*#__PURE__*/_jsxs(Button,{onClick:resendEmail,color:\"green\",className:\"flex items-center gap-3\",disabled:isButtonDisabled,children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faEnvelope}),\"Verify your email\"]})}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-2 text-center  text-sm text-gray-500\",children:/*#__PURE__*/_jsx(\"span\",{children:isButtonDisabled?\"Wait for (\".concat(countdown,\"s) for resending the email\"):\"\"})}),/*#__PURE__*/_jsxs(\"p\",{className:\"mt-2 text-center  text-sm text-gray-500\",children:[/*#__PURE__*/_jsxs(\"span\",{children:[userEmail,\" Not your email ?\"]}),/*#__PURE__*/_jsx(\"span\",{onClick:resetFields,className:\"ml-2 font-semibold leading-6 text-indigo-600 hover:text-indigo-500 cursor-pointer\",children:\"Signup\"})]})]})]})})});};export default EmailVerification;","map":{"version":3,"names":["useContext","useEffect","useState","bgImage","emailImage","useLocation","useNavigate","AuthContext","Button","FontAwesomeIcon","faEnvelope","useParams","ME","resendVerificationEmail","verifyEmail","toast","jsx","_jsx","jsxs","_jsxs","EmailVerification","zoom","setZoom","userEmail","setUserEmail","navigate","checkLogin","location","isButtonDisabled","setIsButtonDisabled","countdown","setCountdown","emailVerification","token","response","error","localStorage","clear","isVerified","removeItem","success","console","log","message","params","URLSearchParams","search","get","email","getItem","setTimeout","resetFields","resendEmail","setItem","Date","now","toString","twoMinutesInMillis","timer","setInterval","prevCountdown","clearInterval","className","style","backgroundImage","concat","children","src","alt","onClick","color","disabled","icon"],"sources":["D:/dev/spa/src/components/EmailVerification/EmailVerification.js"],"sourcesContent":["import { useContext, useEffect, useState } from \"react\";\r\nimport bgImage from \"../../assets/img/backgroundImage.png\";\r\nimport emailImage from \"../../assets/img/emailVerification.png\";\r\nimport { useLocation, useNavigate } from \"react-router-dom\";\r\nimport { AuthContext } from \"../../context/AuthContext\";\r\nimport { Button } from \"@material-tailwind/react\";\r\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\r\nimport { faEnvelope } from \"@fortawesome/free-solid-svg-icons\";\r\nimport { useParams } from \"react-router-dom\";\r\nimport {\r\n  ME,\r\n  resendVerificationEmail,\r\n  verifyEmail,\r\n} from \"../../service/api_service\";\r\nimport toast from \"react-hot-toast\";\r\nconst EmailVerification = () => {\r\n  const [zoom, setZoom] = useState(\"scale-0\");\r\n  const [userEmail, setUserEmail] = useState(\"\");\r\n  const navigate = useNavigate();\r\n  const { checkLogin } = useContext(AuthContext);\r\n  const location = useLocation();\r\n  const [isButtonDisabled, setIsButtonDisabled] = useState(false);\r\n  const [countdown, setCountdown] = useState(0);\r\n\r\n  useEffect(() => {\r\n    async function emailVerification(token) {\r\n      try {\r\n        const response = await verifyEmail(token);\r\n        if (response === \"User already verified\") {\r\n          toast.error(\"User already verified\");\r\n          localStorage.clear();\r\n          navigate(\"/login\");\r\n        }\r\n        if (response === \"jwt expired\") {\r\n          toast.error(\"Verified link Expired!\");\r\n          navigate(\"/login\");\r\n          return;\r\n        }\r\n        if (response.isVerified) {\r\n          localStorage.removeItem(\"verifyEmail\");\r\n          toast.success(\"Email Verified Successfully!\");\r\n          navigate(\"/login\");\r\n        }\r\n      } catch (error) {\r\n        console.log(\"error in verifyEmail use effects\", error);\r\n        if (error === \"User already verified\") {\r\n          toast.error(\"User already verified\");\r\n          localStorage.clear();\r\n          navigate(\"/login\");\r\n          return;\r\n        }\r\n        toast.error(error?.message || error);\r\n      }\r\n    }\r\n\r\n    const params = new URLSearchParams(location.search);\r\n    const token = params.get(\"token\");\r\n    if (token) {\r\n      emailVerification(token);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const email = localStorage.getItem(\"userEmail\");\r\n    setUserEmail(email);\r\n    checkLogin(\"/login\");\r\n    setTimeout(() => {\r\n      setZoom(\"scale-100\");\r\n    }, 500); // Adjust the delay as needed\r\n  }, []);\r\n\r\n  const resetFields = async () => {\r\n    localStorage.clear();\r\n    navigate(\"/sign-up\");\r\n  };\r\n\r\n  const resendEmail = async () => {\r\n    const userEmail = localStorage.getItem(\"userEmail\");\r\n    await resendVerificationEmail(userEmail);\r\n    toast.success(\"Verification Email Sent!\");\r\n\r\n    setIsButtonDisabled(true);\r\n    localStorage.setItem(\"buttonClickTimestamp\", Date.now().toString());\r\n    const twoMinutesInMillis = 2 * 60 * 1000;\r\n    setCountdown(120);\r\n    const timer = setInterval(() => {\r\n      setCountdown((prevCountdown) => prevCountdown - 1);\r\n    }, 1000);\r\n    setTimeout(() => {\r\n      clearInterval(timer);\r\n      setIsButtonDisabled(false);\r\n      localStorage.removeItem(\"buttonClickTimestamp\");\r\n      setCountdown(0);\r\n    }, twoMinutesInMillis);\r\n  };\r\n\r\n  return (\r\n    <div\r\n      className='bg-cover bg-center h-screen'\r\n      style={{\r\n        backgroundImage: `url(${bgImage})`,\r\n      }}\r\n    >\r\n      <div\r\n        className={`flex min-h-full flex-col justify-center h-full px-4 py-8 lg:px-8`}\r\n      >\r\n        <div\r\n          className={`${zoom} transition-transform duration-500 ease-in-out sm:mx-auto sm:w-full sm:max-w-sm p-6 bg-grey-100 border border-gray-100 rounded-lg shadow dark:bg-gray-100 dark:border-gray-200`}\r\n        >\r\n          <div className='sm:mx-auto sm:w-full sm:max-w-sm'>\r\n            {/* <img\r\n              className='mx-auto h-10 w-auto'\r\n              src='https://tailwindui.com/img/logos/mark.svg?color=indigo&shade=600'\r\n              alt='Your Company'\r\n            ></img> */}\r\n          </div>\r\n\r\n          <div className=' sm:mx-auto sm:w-full sm:max-w-md'>\r\n            <div className=''>\r\n              <div>\r\n                <img\r\n                  className=' h-full w-auto'\r\n                  src={emailImage}\r\n                  alt='Your Company'\r\n                ></img>\r\n              </div>\r\n              <div>\r\n                <h2 className='text-center text-2xl font-semibold leading-9 tracking-tight text-gray-900'>\r\n                  Verify your account\r\n                </h2>\r\n              </div>\r\n              <div className='text-center flex flex-col mt-4'>\r\n                <span>Thanks for signup with us.</span>\r\n                <span>\r\n                  Click on the button below to verify your email address.\r\n                </span>\r\n              </div>\r\n            </div>\r\n            <div className=' sm:mx-auto sm:w-full sm:max flex justify-center mt-4'>\r\n              <Button\r\n                onClick={resendEmail}\r\n                color='green'\r\n                className='flex items-center gap-3'\r\n                disabled={isButtonDisabled}\r\n              >\r\n                <FontAwesomeIcon icon={faEnvelope} />\r\n                Verify your email\r\n              </Button>\r\n            </div>\r\n            {/* <div className='text-sm text-center mt-2'> */}\r\n            {/* <span>{userEmail}</span> */}\r\n            {/* </div> */}\r\n            <p className='mt-2 text-center  text-sm text-gray-500'>\r\n              <span>\r\n                {isButtonDisabled\r\n                  ? `Wait for (${countdown}s) for resending the email`\r\n                  : \"\"}\r\n              </span>\r\n            </p>\r\n            <p className='mt-2 text-center  text-sm text-gray-500'>\r\n              <span>{userEmail} Not your email ?</span>\r\n              <span\r\n                onClick={resetFields}\r\n                className='ml-2 font-semibold leading-6 text-indigo-600 hover:text-indigo-500 cursor-pointer'\r\n              >\r\n                Signup\r\n              </span>\r\n            </p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default EmailVerification;\r\n"],"mappings":"AAAA,OAASA,UAAU,CAAEC,SAAS,CAAEC,QAAQ,KAAQ,OAAO,CACvD,MAAO,CAAAC,OAAO,KAAM,sCAAsC,CAC1D,MAAO,CAAAC,UAAU,KAAM,wCAAwC,CAC/D,OAASC,WAAW,CAAEC,WAAW,KAAQ,kBAAkB,CAC3D,OAASC,WAAW,KAAQ,2BAA2B,CACvD,OAASC,MAAM,KAAQ,0BAA0B,CACjD,OAASC,eAAe,KAAQ,gCAAgC,CAChE,OAASC,UAAU,KAAQ,mCAAmC,CAC9D,OAASC,SAAS,KAAQ,kBAAkB,CAC5C,OACEC,EAAE,CACFC,uBAAuB,CACvBC,WAAW,KACN,2BAA2B,CAClC,MAAO,CAAAC,KAAK,KAAM,iBAAiB,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBACpC,KAAM,CAAAC,iBAAiB,CAAGA,CAAA,GAAM,CAC9B,KAAM,CAACC,IAAI,CAAEC,OAAO,CAAC,CAAGpB,QAAQ,CAAC,SAAS,CAAC,CAC3C,KAAM,CAACqB,SAAS,CAAEC,YAAY,CAAC,CAAGtB,QAAQ,CAAC,EAAE,CAAC,CAC9C,KAAM,CAAAuB,QAAQ,CAAGnB,WAAW,CAAC,CAAC,CAC9B,KAAM,CAAEoB,UAAW,CAAC,CAAG1B,UAAU,CAACO,WAAW,CAAC,CAC9C,KAAM,CAAAoB,QAAQ,CAAGtB,WAAW,CAAC,CAAC,CAC9B,KAAM,CAACuB,gBAAgB,CAAEC,mBAAmB,CAAC,CAAG3B,QAAQ,CAAC,KAAK,CAAC,CAC/D,KAAM,CAAC4B,SAAS,CAAEC,YAAY,CAAC,CAAG7B,QAAQ,CAAC,CAAC,CAAC,CAE7CD,SAAS,CAAC,IAAM,CACd,cAAe,CAAA+B,iBAAiBA,CAACC,KAAK,CAAE,CACtC,GAAI,CACF,KAAM,CAAAC,QAAQ,CAAG,KAAM,CAAApB,WAAW,CAACmB,KAAK,CAAC,CACzC,GAAIC,QAAQ,GAAK,uBAAuB,CAAE,CACxCnB,KAAK,CAACoB,KAAK,CAAC,uBAAuB,CAAC,CACpCC,YAAY,CAACC,KAAK,CAAC,CAAC,CACpBZ,QAAQ,CAAC,QAAQ,CAAC,CACpB,CACA,GAAIS,QAAQ,GAAK,aAAa,CAAE,CAC9BnB,KAAK,CAACoB,KAAK,CAAC,wBAAwB,CAAC,CACrCV,QAAQ,CAAC,QAAQ,CAAC,CAClB,OACF,CACA,GAAIS,QAAQ,CAACI,UAAU,CAAE,CACvBF,YAAY,CAACG,UAAU,CAAC,aAAa,CAAC,CACtCxB,KAAK,CAACyB,OAAO,CAAC,8BAA8B,CAAC,CAC7Cf,QAAQ,CAAC,QAAQ,CAAC,CACpB,CACF,CAAE,MAAOU,KAAK,CAAE,CACdM,OAAO,CAACC,GAAG,CAAC,kCAAkC,CAAEP,KAAK,CAAC,CACtD,GAAIA,KAAK,GAAK,uBAAuB,CAAE,CACrCpB,KAAK,CAACoB,KAAK,CAAC,uBAAuB,CAAC,CACpCC,YAAY,CAACC,KAAK,CAAC,CAAC,CACpBZ,QAAQ,CAAC,QAAQ,CAAC,CAClB,OACF,CACAV,KAAK,CAACoB,KAAK,CAAC,CAAAA,KAAK,SAALA,KAAK,iBAALA,KAAK,CAAEQ,OAAO,GAAIR,KAAK,CAAC,CACtC,CACF,CAEA,KAAM,CAAAS,MAAM,CAAG,GAAI,CAAAC,eAAe,CAAClB,QAAQ,CAACmB,MAAM,CAAC,CACnD,KAAM,CAAAb,KAAK,CAAGW,MAAM,CAACG,GAAG,CAAC,OAAO,CAAC,CACjC,GAAId,KAAK,CAAE,CACTD,iBAAiB,CAACC,KAAK,CAAC,CAC1B,CACF,CAAC,CAAE,EAAE,CAAC,CAENhC,SAAS,CAAC,IAAM,CACd,KAAM,CAAA+C,KAAK,CAAGZ,YAAY,CAACa,OAAO,CAAC,WAAW,CAAC,CAC/CzB,YAAY,CAACwB,KAAK,CAAC,CACnBtB,UAAU,CAAC,QAAQ,CAAC,CACpBwB,UAAU,CAAC,IAAM,CACf5B,OAAO,CAAC,WAAW,CAAC,CACtB,CAAC,CAAE,GAAG,CAAC,CAAE;AACX,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAA6B,WAAW,CAAG,KAAAA,CAAA,GAAY,CAC9Bf,YAAY,CAACC,KAAK,CAAC,CAAC,CACpBZ,QAAQ,CAAC,UAAU,CAAC,CACtB,CAAC,CAED,KAAM,CAAA2B,WAAW,CAAG,KAAAA,CAAA,GAAY,CAC9B,KAAM,CAAA7B,SAAS,CAAGa,YAAY,CAACa,OAAO,CAAC,WAAW,CAAC,CACnD,KAAM,CAAApC,uBAAuB,CAACU,SAAS,CAAC,CACxCR,KAAK,CAACyB,OAAO,CAAC,0BAA0B,CAAC,CAEzCX,mBAAmB,CAAC,IAAI,CAAC,CACzBO,YAAY,CAACiB,OAAO,CAAC,sBAAsB,CAAEC,IAAI,CAACC,GAAG,CAAC,CAAC,CAACC,QAAQ,CAAC,CAAC,CAAC,CACnE,KAAM,CAAAC,kBAAkB,CAAG,CAAC,CAAG,EAAE,CAAG,IAAI,CACxC1B,YAAY,CAAC,GAAG,CAAC,CACjB,KAAM,CAAA2B,KAAK,CAAGC,WAAW,CAAC,IAAM,CAC9B5B,YAAY,CAAE6B,aAAa,EAAKA,aAAa,CAAG,CAAC,CAAC,CACpD,CAAC,CAAE,IAAI,CAAC,CACRV,UAAU,CAAC,IAAM,CACfW,aAAa,CAACH,KAAK,CAAC,CACpB7B,mBAAmB,CAAC,KAAK,CAAC,CAC1BO,YAAY,CAACG,UAAU,CAAC,sBAAsB,CAAC,CAC/CR,YAAY,CAAC,CAAC,CAAC,CACjB,CAAC,CAAE0B,kBAAkB,CAAC,CACxB,CAAC,CAED,mBACExC,IAAA,QACE6C,SAAS,CAAC,6BAA6B,CACvCC,KAAK,CAAE,CACLC,eAAe,QAAAC,MAAA,CAAS9D,OAAO,KACjC,CAAE,CAAA+D,QAAA,cAEFjD,IAAA,QACE6C,SAAS,mEAAqE,CAAAI,QAAA,cAE9E/C,KAAA,QACE2C,SAAS,IAAAG,MAAA,CAAK5C,IAAI,kLAAiL,CAAA6C,QAAA,eAEnMjD,IAAA,QAAK6C,SAAS,CAAC,kCAAkC,CAM5C,CAAC,cAEN3C,KAAA,QAAK2C,SAAS,CAAC,mCAAmC,CAAAI,QAAA,eAChD/C,KAAA,QAAK2C,SAAS,CAAC,EAAE,CAAAI,QAAA,eACfjD,IAAA,QAAAiD,QAAA,cACEjD,IAAA,QACE6C,SAAS,CAAC,gBAAgB,CAC1BK,GAAG,CAAE/D,UAAW,CAChBgE,GAAG,CAAC,cAAc,CACd,CAAC,CACJ,CAAC,cACNnD,IAAA,QAAAiD,QAAA,cACEjD,IAAA,OAAI6C,SAAS,CAAC,2EAA2E,CAAAI,QAAA,CAAC,qBAE1F,CAAI,CAAC,CACF,CAAC,cACN/C,KAAA,QAAK2C,SAAS,CAAC,gCAAgC,CAAAI,QAAA,eAC7CjD,IAAA,SAAAiD,QAAA,CAAM,4BAA0B,CAAM,CAAC,cACvCjD,IAAA,SAAAiD,QAAA,CAAM,yDAEN,CAAM,CAAC,EACJ,CAAC,EACH,CAAC,cACNjD,IAAA,QAAK6C,SAAS,CAAC,uDAAuD,CAAAI,QAAA,cACpE/C,KAAA,CAACX,MAAM,EACL6D,OAAO,CAAEjB,WAAY,CACrBkB,KAAK,CAAC,OAAO,CACbR,SAAS,CAAC,yBAAyB,CACnCS,QAAQ,CAAE3C,gBAAiB,CAAAsC,QAAA,eAE3BjD,IAAA,CAACR,eAAe,EAAC+D,IAAI,CAAE9D,UAAW,CAAE,CAAC,oBAEvC,EAAQ,CAAC,CACN,CAAC,cAINO,IAAA,MAAG6C,SAAS,CAAC,yCAAyC,CAAAI,QAAA,cACpDjD,IAAA,SAAAiD,QAAA,CACGtC,gBAAgB,cAAAqC,MAAA,CACAnC,SAAS,+BACtB,EAAE,CACF,CAAC,CACN,CAAC,cACJX,KAAA,MAAG2C,SAAS,CAAC,yCAAyC,CAAAI,QAAA,eACpD/C,KAAA,SAAA+C,QAAA,EAAO3C,SAAS,CAAC,mBAAiB,EAAM,CAAC,cACzCN,IAAA,SACEoD,OAAO,CAAElB,WAAY,CACrBW,SAAS,CAAC,mFAAmF,CAAAI,QAAA,CAC9F,QAED,CAAM,CAAC,EACN,CAAC,EACD,CAAC,EACH,CAAC,CACH,CAAC,CACH,CAAC,CAEV,CAAC,CAED,cAAe,CAAA9C,iBAAiB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}